---
import { getLangFromUrl, useTranslations, languages } from "../utils/i18n";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<nav
  class="fixed top-0 left-0 right-0 z-50 py-6 md:py-8 px-6 md:px-12 bg-bg-primary/90 backdrop-blur-md transition-[padding,background-color,border-color] duration-300 border-b border-transparent"
  id="main-nav"
>
  <div class="max-w-7xl mx-auto flex justify-between items-center">
    <a
      href={lang === "cz" ? "/" : "/en/"}
      class="text-xl font-serif tracking-tight hover:opacity-70 transition-opacity relative z-50"
      aria-label="Home"
    >
      Tomas Astro<span class="text-zinc-500">.</span>
    </a>

    <!-- Desktop Menu -->
    <div class="hidden md:flex items-center gap-12">
      <ul
        class="flex gap-10 text-[13px] uppercase tracking-[0.2em] font-medium text-zinc-400"
      >
        <li>
          <a
            href="/galleries"
            class="hover:text-white transition-colors link-hover"
            >{t("nav.galleries")}
          </a>
        </li>
        <li>
          <a
            href={lang === "cz" ? "/about" : "/en/about"}
            class="hover:text-white transition-colors link-hover"
            >{t("nav.about")}
          </a>
        </li>
      </ul>

      <div
        class="flex gap-4 text-[11px] font-bold uppercase tracking-widest border-l border-white/10 pl-12"
      >
        {
          Object.entries(languages).map(([code, label]) => (
            <a
              href={code === "cz" ? "/" : `/${code}/`}
              class={`transition-colors hover:text-white ${
                lang === code ? "text-white" : "text-zinc-600"
              }`}
              aria-label={`Switch to ${label}`}
            >
              {code}
            </a>
          ))
        }
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden flex flex-col justify-center items-end gap-1.5 w-8 h-8 z-50 text-white cursor-pointer group/btn"
      aria-label="Toggle Navigation Menu"
      aria-expanded="false"
    >
      <span
        class="w-full h-[2px] bg-current transition-[transform,opacity] duration-300 origin-right group-aria-expanded/btn:rotate-[-45deg] group-aria-expanded/btn:translate-y-[-1px]"
      ></span>
      <span
        class="w-full h-[2px] bg-current transition-[transform,opacity] duration-300 group-aria-expanded/btn:opacity-0 group-aria-expanded/btn:translate-x-full"
      ></span>
      <span
        class="w-3/4 h-[2px] bg-current transition-[transform,width] duration-300 origin-right group-aria-expanded/btn:w-full group-aria-expanded/btn:rotate-[45deg] group-aria-expanded/btn:translate-y-[1px]"
      ></span>
    </button>
  </div>
</nav>

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu"
  class="fixed inset-0 bg-bg-primary z-40 flex flex-col justify-center items-center opacity-0 pointer-events-none transition-opacity duration-300 md:hidden"
>
  <ul
    class="flex flex-col gap-8 text-center text-xl uppercase tracking-[0.2em] font-medium text-zinc-400 w-full px-6"
  >
    <li>
      <a href="/galleries" class="block hover:text-white transition-colors py-2"
        >{t("nav.galleries")}
      </a>
    </li>
    <li>
      <a
        href={lang === "cz" ? "/about" : "/en/about"}
        class="block hover:text-white transition-colors py-2"
        >{t("nav.about")}
      </a>
    </li>
  </ul>

  <div
    class="flex gap-8 text-sm font-bold uppercase tracking-widest mt-16 pt-10 border-t border-white/10 w-4/5 justify-center"
  >
    {
      Object.entries(languages).map(([code, label]) => (
        <a
          href={code === "cz" ? "/" : `/${code}/`}
          class={`transition-colors hover:text-white ${
            lang === code ? "text-white" : "text-zinc-600"
          }`}
          aria-label={`Switch to ${label}`}
        >
          {code}
        </a>
      ))
    }
  </div>
</div>

<script>
  const btn = document.getElementById("mobile-menu-btn");
  const menu = document.getElementById("mobile-menu");
  const nav = document.getElementById("main-nav");
  const spans = btn?.querySelectorAll("span");
  let isOpen = false;

  btn?.addEventListener("click", () => {
    isOpen = !isOpen;
    btn.setAttribute("aria-expanded", isOpen.toString());

    if (isOpen) {
      menu?.classList.remove("opacity-0", "pointer-events-none");
      menu?.classList.add("opacity-100", "pointer-events-auto");
      document.body.style.overflow = "hidden"; // Prevent scrolling

      nav?.classList.add("border-white/10", "bg-bg-primary");
      nav?.classList.remove(
        "bg-bg-primary/90",
        "backdrop-blur-md",
        "border-transparent"
      );
    } else {
      menu?.classList.add("opacity-0", "pointer-events-none");
      menu?.classList.remove("opacity-100", "pointer-events-auto");
      document.body.style.overflow = "";

      nav?.classList.remove("border-white/10", "bg-bg-primary");
      nav?.classList.add(
        "bg-bg-primary/90",
        "backdrop-blur-md",
        "border-transparent"
      );
    }
  });
</script>
